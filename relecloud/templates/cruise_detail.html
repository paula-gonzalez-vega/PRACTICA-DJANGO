{% extends 'base.html' %}

{% block title %}
ReleCloud - {{ cruise }}
{% endblock %}

{% block content %}
<h1>{{ cruise }}</h1>
<p>
{{ cruise.description }}
</p>
<p>You can explore {{ cruise }} on the following cruises:</p>
<ul class="list-group">
    {% for destination in cruise.destinations.all %}
    <a class="list-group-item list-group-item-action" href="{% url 'destination_detail' destination.id %}">{{ destination }}</a>
    {% endfor %}
</ul>

<!-- BotÃ³n de compra -->
{% if user.is_authenticated and not has_purchased %}
<div class="mt-4 mb-4">
    <form action="{% url 'buy_cruise' cruise.pk %}" method="post">
        {% csrf_token %}
        <button type="submit" class="btn btn-success btn-lg">Buy cruise</button>
    </form>
</div>
{% endif %}

<!-- Reviews solo si puede -->
{% if can_review %}
<div class="mt-5">
    <h3>Reviews</h3>
    {% if has_purchased %}
        <h5>Average rating: {{ avg_rating }}/10</h5>
    {% else %}
        <p>No reviews yet</p>
    {% endif %}
</div>

<!-- Formulario de review -->
<div class="mt-4 mb-4 p-3 border rounded bg-light">
    <h4>Leave a review</h4>
    <form method="post" action="{% url 'cruise_review' cruise.pk %}">
        {% csrf_token %}
        {{ review_form.as_p }}
        <button class="btn btn-success" type="submit">Submit</button>
    </form>
</div>

<!-- All reviews -->
<div class="mt-4">
    <h4>All Reviews</h4>
    <ul class="list-group">
        {% for review in reviews %}
            <li class="list-group-item">
                <strong>{{ review.user.username }}</strong> - {{ review.rating }}/10
                <p>{{ review.comment }}</p>
            </li>
        {% empty %}
            <li class="list-group-item">No reviews yet</li>
        {% endfor %}
    </ul>
</div>
{% endif %}
{% endblock content %}